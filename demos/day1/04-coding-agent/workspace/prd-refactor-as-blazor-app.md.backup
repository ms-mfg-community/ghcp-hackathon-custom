# 1. Product Requirements Document (PRD): Blazor Server Calculator Refactoring

## 1.1 Document Information

- **Version:** 1.0
- **Author:** GitHub Copilot
- **Date:** November 4th, 2025
- **Status:** Draft

## 1.2 Executive Summary

This document describes the requirements for refactoring the existing .NET 8 console calculator application into a Blazor Server web application. The project will preserve all existing calculator functionality and test coverage while providing a modern, interactive web-based user interface that can be tested locally. The core `CalculatorOperations` class will remain unchanged to maintain compatibility with the existing xUnit test suite.

## 1.3 Problem Statement

The current console calculator application demonstrates excellent .NET practices and comprehensive testing but lacks the accessibility and user experience benefits of a web interface. Developers and users need:

- A web-based calculator that can be accessed through a browser
- An interactive UI that provides immediate visual feedback
- A solution that maintains the existing business logic and test coverage
- A practical example of migrating console applications to Blazor Server architecture
- The ability to test and run the application locally during development

## 1.4 Goals and Objectives

- Refactor the console calculator into a Blazor Server web application
- Preserve all existing calculator operations and business logic in the `CalculatorOperations` class
- Maintain 100% compatibility with the existing 50 xUnit tests
- Create an intuitive, responsive web UI for calculator operations
- Enable local testing and development with minimal setup
- Demonstrate Blazor Server best practices including component architecture and data binding
- Provide comprehensive documentation for setup, testing, and deployment

## 1.5 Scope

### 1.5.1 In Scope

- New Blazor Server project (`calculator.web`) added to existing solution
- CalculatorService wrapper class for improved testability with Playwright
- Calculator.razor component with calculator keypad UI layout
- Calculation history tracking functionality with scoped service pattern
- Keyboard shortcuts for operators and Enter key to calculate
- Input validation and error handling in the web interface
- Support for all six arithmetic operations (+, -, *, /, %, ^)
- Bootstrap-based styling for clean, professional calculator appearance
- Project reference to existing calculator library
- PowerShell setup script for automation
- Local testing documentation
- Blazor-specific error display mechanisms

### 1.5.2 Out of Scope

- Modifications to the existing console application
- Changes to the `CalculatorOperations` class or test suite
- Authentication or user management
- Calculation history persistence (database integration)
- Deployment to production environments
- Mobile-specific UI optimizations
- Advanced calculator features beyond the six existing operations
- API endpoints or REST services

## 1.6 User Stories / Use Cases

- As a user, I want to access the calculator through a web browser so I can perform calculations without installing software
- As a user, I want to select operations from a dropdown menu so I can easily choose the correct operation
- As a user, I want immediate visual feedback when I enter invalid data so I can correct mistakes quickly
- As a user, I want to see calculation results displayed clearly on the same page so I don't lose context
- As a developer, I want to test the web application locally so I can verify changes before deployment
- As a developer, I want the business logic to remain separate from the UI so I can maintain and test it independently
- As a QA tester, I want all existing unit tests to continue passing so I can verify no regression has occurred

## 1.7 Functional Requirements

| Requirement ID | Description |
|---|---|
| FR-1 | The Blazor application shall provide input fields for first operand and second operand |
| FR-2 | The Blazor application shall provide a dropdown selector for choosing operations (+, -, *, /, %, ^) |
| FR-3 | The Blazor application shall include a "Calculate" button to trigger the operation |
| FR-4 | The Blazor application shall display calculation results on the same page |
| FR-5 | The Blazor application shall validate numeric input and display appropriate error messages |
| FR-6 | The Blazor application shall handle division by zero errors gracefully with user-friendly messages |
| FR-7 | The Blazor application shall handle modulo by zero errors gracefully with user-friendly messages |
| FR-8 | The Blazor application shall use the existing `CalculatorOperations` static class for all calculations |
| FR-9 | The Blazor application shall clear previous error messages when new calculations are performed |
| FR-10 | The Blazor application shall support decimal number inputs |
| FR-11 | The Blazor application shall be accessible via localhost for testing |
| FR-12 | All 50 existing xUnit tests shall continue to pass without modification |
| FR-13 | The solution shall include both console and web projects simultaneously |
| FR-14 | The Blazor application shall provide immediate visual feedback for user interactions |
| FR-15 | The web interface shall be responsive and functional on different browser window sizes |

## 1.8 Non-Functional Requirements

- **Performance:** Calculations shall execute and display results within 100ms
- **Usability:** The web interface shall be intuitive requiring no training or documentation for basic use
- **Reliability:** The application shall handle all edge cases and invalid inputs without crashing
- **Testability:** All existing unit tests shall remain valid and passing
- **Maintainability:** Code shall follow Blazor and C# best practices with clear separation of concerns
- **Compatibility:** The application shall run on .NET 8 and be testable in modern browsers (Chrome, Edge, Firefox)
- **Development Experience:** Local testing shall require only `dotnet run` command with no additional configuration
- **Accessibility:** The UI shall follow basic web accessibility guidelines (semantic HTML, keyboard navigation)

## 1.9 Assumptions and Dependencies

- The existing calculator solution structure is intact and all tests are passing
- Development environment has .NET 8 SDK installed
- The `CalculatorOperations` class will not be modified
- Developers have access to a modern web browser for testing
- The Blazor Server template and dependencies are available through .NET SDK
- Local development will use HTTPS with dev certificates
- Bootstrap CSS framework (included by default in Blazor template) is acceptable for styling

## 1.10 Success Criteria / KPIs

- Blazor Server project successfully added to solution and builds without errors
- All six calculator operations function correctly in the web interface
- All 50 xUnit tests continue to pass
- Application runs locally using `dotnet run` and is accessible in browser
- Input validation prevents invalid operations and provides clear error messages
- Zero regression in existing calculator functionality
- Documentation clearly explains local testing procedure
- Setup script successfully automates project creation

## 1.11 Milestones & Timeline

1. **Project Setup (Phase 1)**
   - Create Blazor Server project in solution
   - Configure project references to calculator library
   - Verify solution builds successfully

2. **Component Development (Phase 2)**
   - Create Calculator.razor component with basic UI
   - Implement data binding for inputs and operator selection
   - Wire up Calculate button to call `CalculatorOperations` methods

3. **Error Handling & Validation (Phase 3)**
   - Add input validation for numeric fields
   - Implement error display for division/modulo by zero
   - Add user-friendly error messages for invalid inputs

4. **Styling & UX (Phase 4)**
   - Apply Bootstrap styling for professional appearance
   - Ensure responsive layout
   - Add visual feedback for user interactions

5. **Testing & Verification (Phase 5)**
   - Run all 50 xUnit tests to verify no regression
   - Perform manual testing of web interface
   - Test all six operations with various inputs
   - Verify local testing workflow

6. **Automation & Documentation (Phase 6)**
   - Create PowerShell setup script
   - Document local testing instructions
   - Update README with Blazor-specific information

## 1.12 Implementation Guidance

### 1.12.1 Project Structure

The refactored solution will have the following structure:

```text
calculator-xunit-testing/
├── calculator/                    # Existing console app (unchanged)
│   ├── Calculator.cs
│   └── calculator.csproj
├── calculator.tests/              # Existing xUnit tests (unchanged)
│   ├── CalculatorTest.cs
│   └── calculator.tests.csproj
├── calculator.web/                # New Blazor Server project
│   ├── Pages/
│   │   ├── Calculator.razor      # Main calculator component
│   │   ├── Index.razor           # Home page (optional redirect)
│   │   └── Error.razor           # Error page (template default)
│   ├── Shared/
│   │   ├── MainLayout.razor
│   │   └── NavMenu.razor
│   ├── wwwroot/
│   │   └── css/                  # Custom styles if needed
│   ├── App.razor
│   ├── Program.cs
│   └── calculator.web.csproj
└── calculator.sln                 # Updated solution file
```

### 1.12.2 Blazor Project Creation

**PowerShell Script: `Set-BlazorCalculator.ps1`**

```powershell
# Navigate to solution directory
$repoRoot = git rev-parse --show-toplevel
$workspacePath = "demos\day1\04-coding-agent\workspace\calculator-xunit-testing"
Set-Location "$repoRoot\$workspacePath"

# Create Blazor Server project
dotnet new blazorserver -n calculator.web -o calculator.web

# Add project to solution
dotnet sln add calculator.web/calculator.web.csproj

# Add reference to calculator library
dotnet add calculator.web/calculator.web.csproj reference calculator/calculator.csproj

# Build solution to verify
dotnet build

Write-Host "Blazor Server project created successfully!" -ForegroundColor Green
Write-Host "To run the web application:" -ForegroundColor Cyan
Write-Host "  cd calculator.web" -ForegroundColor Yellow
Write-Host "  dotnet run" -ForegroundColor Yellow
```

### 1.12.3 Calculator.razor Component Implementation

**Component Location:** `calculator.web/Pages/Calculator.razor`

**Key Features:**

- `@page "/calculator"` directive for routing
- Two-way data binding with `@bind` for input fields
- Dropdown for operator selection
- Button click event handler for calculation
- Conditional rendering for results and errors
- Try-catch block for exception handling

**Component Structure:**

```razor
@page "/calculator"
@using calculator

<PageTitle>Calculator</PageTitle>

<h1>Blazor Calculator</h1>

<div class="calculator-container">
    <!-- First Operand Input -->
    <div class="mb-3">
        <label>First Number:</label>
        <input type="number" @bind="firstOperand" class="form-control" />
    </div>

    <!-- Second Operand Input -->
    <div class="mb-3">
        <label>Second Number:</label>
        <input type="number" @bind="secondOperand" class="form-control" />
    </div>

    <!-- Operator Selection -->
    <div class="mb-3">
        <label>Operation:</label>
        <select @bind="selectedOperator" class="form-select">
            <option value="+">Addition (+)</option>
            <option value="-">Subtraction (-)</option>
            <option value="*">Multiplication (*)</option>
            <option value="/">Division (/)</option>
            <option value="%">Modulo (%)</option>
            <option value="^">Exponent (^)</option>
        </select>
    </div>

    <!-- Calculate Button -->
    <button class="btn btn-primary" @onclick="Calculate">Calculate</button>

    <!-- Result Display -->
    @if (hasResult)
    {
        <div class="alert alert-success mt-3">
            <strong>Result:</strong> @result
        </div>
    }

    <!-- Error Display -->
    @if (!string.IsNullOrEmpty(errorMessage))
    {
        <div class="alert alert-danger mt-3">
            <strong>Error:</strong> @errorMessage
        </div>
    }
</div>

@code {
    private double firstOperand = 0;
    private double secondOperand = 0;
    private string selectedOperator = "+";
    private double result = 0;
    private bool hasResult = false;
    private string errorMessage = string.Empty;

    private void Calculate()
    {
        // Clear previous results and errors
        hasResult = false;
        errorMessage = string.Empty;

        try
        {
            result = selectedOperator switch
            {
                "+" => CalculatorOperations.Add(firstOperand, secondOperand),
                "-" => CalculatorOperations.Subtract(firstOperand, secondOperand),
                "*" => CalculatorOperations.Multiply(firstOperand, secondOperand),
                "/" => CalculatorOperations.Divide(firstOperand, secondOperand),
                "%" => CalculatorOperations.Modulo(firstOperand, secondOperand),
                "^" => CalculatorOperations.Exponent(firstOperand, secondOperand),
                _ => throw new InvalidOperationException("Invalid operator")
            };

            hasResult = true;
        }
        catch (DivideByZeroException ex)
        {
            errorMessage = ex.Message;
        }
        catch (Exception ex)
        {
            errorMessage = $"An error occurred: {ex.Message}";
        }
    }
}
```

### 1.12.4 Navigation Configuration

**Update NavMenu.razor** to include calculator link:

```razor
<div class="nav-item px-3">
    <NavLink class="nav-link" href="calculator">
        <span class="oi oi-calculator" aria-hidden="true"></span> Calculator
    </NavLink>
</div>
```

**Optional: Update Index.razor** to redirect to calculator:

```razor
@page "/"

<PageTitle>Home</PageTitle>

<h1>Welcome to Blazor Calculator</h1>

<p>
    <a href="/calculator">Go to Calculator</a>
</p>
```

### 1.12.5 Custom Styling (Optional)

**Create:** `calculator.web/wwwroot/css/calculator.css`

```css
.calculator-container {
    max-width: 500px;
    margin: 0 auto;
    padding: 20px;
    border: 1px solid #ddd;
    border-radius: 8px;
    background-color: #f9f9f9;
}

.calculator-container input,
.calculator-container select {
    font-size: 1.1rem;
}

.calculator-container button {
    width: 100%;
    font-size: 1.2rem;
    padding: 10px;
}
```

**Reference in App.razor:**

```razor
<link href="css/calculator.css" rel="stylesheet" />
```

### 1.12.6 Local Testing Instructions

1. **Navigate to the Blazor project directory:**

   ```powershell
   cd demos\day1\04-coding-agent\workspace\calculator-xunit-testing\calculator.web
   ```

2. **Run the application:**

   ```powershell
   dotnet run
   ```

3. **Access the application:**
   - Open browser to `https://localhost:5001` or `http://localhost:5000`
   - Or use the URL displayed in the console output

4. **Test calculator functionality:**
   - Navigate to `/calculator` route
   - Enter two numbers
   - Select an operation
   - Click "Calculate"
   - Verify result displays correctly

5. **Test error handling:**
   - Try division by zero
   - Try modulo by zero
   - Verify error messages display appropriately

### 1.12.7 Verification Steps

1. **Build verification:**

   ```powershell
   dotnet build
   ```

   - All projects should build without errors

2. **Test verification:**

   ```powershell
   cd calculator.tests
   dotnet test
   ```

   - All 50 tests should pass

3. **Web application verification:**
   - Run the Blazor app locally
   - Test all six operations
   - Verify input validation
   - Verify error handling

## 1.13 UI Design Decisions

### 1.13.1 Layout Approach

**Selected Approach:** Form-based layout with dropdown operator selection

**Rationale:**

- Aligns with the console application's sequential input pattern
- Simpler to implement and maintain
- Easier to validate inputs
- More accessible for keyboard navigation
- Suitable for educational/demonstration purposes

**Alternative Considered:** Calculator button grid (iOS-style)

- More complex implementation
- Requires more extensive state management
- Better for rapid repeated calculations
- May be implemented in future iterations

### 1.13.2 Error Handling UI

**Selected Approach:** Inline alert messages below the calculate button

**Rationale:**

- Keeps errors in context with the inputs
- Uses Bootstrap alert components (already available)
- Clear visual distinction between results and errors
- No additional libraries required

**Alternatives Considered:**

- Toast notifications (requires additional library)
- Modal dialogs (more intrusive)
- Inline validation under each input (more complex state management)

### 1.13.3 Result Display

**Selected Approach:** Success alert box with result value

**Rationale:**

- Visually distinct from error messages (green vs. red)
- Persistent until next calculation
- Uses standard Bootstrap styling
- Clear and prominent display

## 1.14 Testing Requirements

### 1.14.1 Unit Test Preservation

- All 50 existing xUnit tests must pass without modification
- Test execution should be part of build verification
- No changes to `CalculatorOperations` class or test project

### 1.14.2 Manual Testing Checklist

- [ ] All six operations produce correct results
- [ ] Division by zero displays appropriate error
- [ ] Modulo by zero displays appropriate error
- [ ] Decimal numbers are handled correctly
- [ ] Negative numbers are handled correctly
- [ ] Large numbers are handled correctly
- [ ] Switching operations clears previous results
- [ ] Error messages clear when new calculation succeeds
- [ ] Application is accessible via keyboard navigation
- [ ] Application displays correctly in Chrome, Edge, and Firefox

### 1.14.3 Integration Testing

- [ ] Calculator.razor component correctly calls `CalculatorOperations` methods
- [ ] Project references are configured correctly
- [ ] Solution builds without warnings
- [ ] Application runs locally without errors

## 1.15 Documentation Requirements

### 1.15.1 README Updates

Create a new section in the calculator README documenting:

- Blazor Server project structure
- How to run the web application locally
- Differences between console and web versions
- Troubleshooting common issues

### 1.15.2 Code Documentation

- Add XML comments to Calculator.razor component
- Document the purpose of each @code block member
- Include usage examples in component documentation

### 1.15.3 Setup Script Documentation

- Include header comments in PowerShell script
- Document prerequisites
- Document expected outcomes
- Include troubleshooting section

## 1.16 Future Enhancement Opportunities

While out of scope for this iteration, the following enhancements could be considered for future versions:

- Calculation history feature with persistence
- Advanced calculator operations (trigonometry, logarithms)
- Keyboard shortcuts for operations
- Calculator button grid layout option
- Theme customization (dark mode)
- Export calculation history
- Scientific notation support
- Unit conversion capabilities
- Mobile-optimized responsive design

## 1.17 Risk Assessment

| Risk | Impact | Mitigation |
|---|---|---|
| Breaking existing tests | High | Do not modify `CalculatorOperations` class; verify tests after each change |
| Port conflicts during local testing | Medium | Document default ports; provide instructions for changing ports |
| Browser compatibility issues | Low | Use standard Bootstrap components; test in major browsers |
| HTTPS certificate issues | Medium | Document dev certificate trust process; provide troubleshooting steps |
| Confusion between console and web apps | Low | Clear documentation; separate project folders |

## 1.18 Acceptance Criteria

The Blazor Server refactoring will be considered complete when:

1. Blazor Server project successfully added to solution
2. Calculator.razor component implements all six operations
3. All 50 xUnit tests continue to pass
4. Application runs locally using `dotnet run`
5. All calculator operations produce correct results in web UI
6. Division by zero and modulo by zero errors display appropriately
7. Input validation prevents invalid numeric entries
8. Setup script successfully automates project creation
9. Documentation includes local testing instructions
10. Manual testing checklist is completed and verified

## 1.19 Dependencies & References

- **.NET 8 SDK:** Required for building and running the application
- **Blazor Server Template:** Included with .NET 8 SDK
- **Bootstrap 5:** Included by default in Blazor Server template
- **Existing Calculator Project:** `CalculatorOperations` class must remain accessible
- **xUnit Framework:** Already configured in test project

## 1.20 Appendix: Command Reference

### Common Commands

```powershell
# Build entire solution
dotnet build

# Run tests
cd calculator.tests
dotnet test

# Run web application
cd calculator.web
dotnet run

# Run console application
cd calculator
dotnet run

# Create Blazor project (automated in script)
dotnet new blazorserver -n calculator.web

# Add project to solution
dotnet sln add calculator.web/calculator.web.csproj

# Add project reference
dotnet add calculator.web reference calculator/calculator.csproj
```

### Troubleshooting Commands

```powershell
# Clear build artifacts
dotnet clean

# Restore NuGet packages
dotnet restore

# List project references
dotnet list reference

# Trust HTTPS development certificate
dotnet dev-certs https --trust
```

## 1.21 Glossary

- **Blazor Server:** ASP.NET Core framework for building interactive web UIs using C# instead of JavaScript
- **Component:** Reusable UI element in Blazor, similar to a partial view or user control
- **Data Binding:** Automatic synchronization between UI elements and code variables using `@bind`
- **Razor:** Syntax for embedding C# code in HTML markup
- **Two-way Binding:** Changes in UI update code variables and vice versa
- **Directive:** Special Razor syntax starting with `@` that controls component behavior
- **Route:** URL pattern that maps to a Blazor component (`@page` directive)
